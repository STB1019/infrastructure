version: 1
metadata:
  name: flow_password_change
entries:
  - model: authentik_flows.flow
    attrs:
      designation: stage_configuration
      name: Cambio Password
      title: Cambio Password
    identifiers:
      slug: ieeesb-password-change
    id: flow

  - model: authentik_stages_prompt.prompt # field-prompt-password
    attrs:
      order: 300
      placeholder: Password
      placeholder_expression: false
      required: true
      type: password
    identifiers:
      field_key: password
      label: Password
    id: field-prompt-password

  - model: authentik_stages_prompt.prompt # field-prompt-password-repeat
    attrs:
      order: 301
      placeholder: Ripeti Password
      placeholder_expression: false
      required: true
      type: password
    identifiers:
      field_key: password_repeat
      label: Ripeti Password
    id: field-prompt-password-repeat

  - model: authentik_policies_password.passwordpolicy # policy-password-strength
    id: policy-password-strength
    identifiers:
      name: policy-password-strength
    attrs:
      check_zxcvbn: true
      length_min: 8
      zxcvbn_score_threshold: 2
    
  - model: authentik_stages_prompt.promptstage # prompt-password-change
    attrs:
      fields:
        - !KeyOf field-prompt-password
        - !KeyOf field-prompt-password-repeat
      validation_policies:
        - !KeyOf policy-password-strength
    identifiers:
      name: prompt-password-change
    id: prompt-password-change
    
  - model: authentik_stages_user_write.userwritestage # password-change-write
    identifiers:
      name: password-change-write
    id: password-change-write
    
  - model: authentik_flows.flowstagebinding
    identifiers:
      order: 0
      stage: !KeyOf prompt-password-change
      target: !KeyOf flow
    
  - model: authentik_flows.flowstagebinding
    identifiers:
      order: 1
      stage: !KeyOf password-change-write
      target: !KeyOf flow
